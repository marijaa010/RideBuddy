<div class="container">
  <app-loading-spinner 
    *ngIf="isLoading" 
    message="Loading ride details..."
    size="medium">
  </app-loading-spinner>

  <div *ngIf="!isLoading && ride" class="ride-details-container">
    <div class="ride-header">
      <h1>Ride Details</h1>
      <button class="btn" (click)="router.navigate(['/rides'])">‚Üê Back to list</button>
    </div>

    <div class="details-card">
      <div class="route-section">
        <div class="route-visual">
          <div class="route-point start">
            <i class="fa-solid fa-location-dot icon"></i>
            <div>
              <div class="label">FROM</div>
              <div class="location">{{ ride.originName }}</div>
            </div>
          </div>
          <div class="route-line"></div>
          <div class="route-point end">
            <i class="fa-solid fa-flag-checkered icon"></i>
            <div>
              <div class="label">TO</div>
              <div class="location">{{ ride.destinationName }}</div>
            </div>
          </div>
        </div>

        <app-route-map
          [origin]="{
            name: ride.originName,
            latitude: ride.originLatitude,
            longitude: ride.originLongitude
          }"
          [destination]="{
            name: ride.destinationName,
            latitude: ride.destinationLatitude,
            longitude: ride.destinationLongitude
          }"
          height="450px"
        ></app-route-map>
      </div>

      <div class="info-grid">
        <div class="info-item">
          <i class="fa-regular fa-clock icon"></i>
          <div>
            <div class="label">Departure time</div>
            <div class="value">{{ formatDate(ride.departureTime) }}</div>
            <div class="countdown-badge" *ngIf="!dateFormatter.isPast(ride.departureTime)">
              <i class="fa-solid fa-hourglass-half"></i> Departs in {{ getCountdown(ride.departureTime) }}
            </div>
          </div>
        </div>

        <div class="info-item">
          <i class="fa-solid fa-chair icon"></i>
          <div>
            <div class="label">Available seats</div>
            <div class="value">{{ ride.availableSeats }} / {{ ride.totalSeats }}</div>
          </div>
        </div>

        <div class="info-item">
          <i class="fa-solid fa-coins icon"></i>
          <div>
            <div class="label">Price per seat</div>
            <div class="value price">{{ ride.pricePerSeat }} {{ ride.currency }}</div>
          </div>
        </div>

        <div class="info-item">
          <i class="fa-solid fa-circle-check icon"></i>
          <div>
            <div class="label">Booking type</div>
            <div class="value">{{ ride.autoConfirmBookings ? 'Instant booking' : "Requires driver's approval" }}</div>
          </div>
        </div>
      </div>

      <div class="booking-section" *ngIf="ride.availableSeats > 0 && !isDriverOfRide()">
        <h3>Book This Ride</h3>
        <div class="booking-form">
          <div class="form-group">
            <label for="seats">Number of seats</label>
            <input 
              type="number" 
              id="seats" 
              [(ngModel)]="seatsToBook"
              [min]="1"
              [max]="ride.availableSeats"
            />
          </div>
          <div class="booking-summary">
            <div class="summary-row">
              <span>Seats:</span>
              <span>{{ seatsToBook }}</span>
            </div>
            <div class="summary-row total">
              <span>Total:</span>
              <span>{{ seatsToBook * ride.pricePerSeat }} {{ ride.currency }}</span>
            </div>
          </div>
          <button 
            class="btn btn-success btn-block" 
            (click)="bookRide()"
            [disabled]="isBooking || seatsToBook < 1 || seatsToBook > ride.availableSeats"
          >
            {{ isBooking ? 'Booking...' : 'Submit booking' }}
          </button>
          <p class="booking-note" *ngIf="!authService.isAuthenticated()">
            Please <a routerLink="/identity/login">login</a> to book this ride
          </p>
        </div>
      </div>

      <div class="no-seats" *ngIf="ride.availableSeats === 0">
        <p><i class="fa-solid fa-circle-xmark"></i> This ride is fully booked</p>
      </div>
    </div>
  </div>
</div>
