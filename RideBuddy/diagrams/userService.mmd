classDiagram
    class UserEntity {
        +Guid Id
        +Email Email
        +string FirstName
        +string LastName
        +PhoneNumber PhoneNumber
        +UserRole Role
        +bool IsEmailVerified
        +DateTime CreatedAt
        +DateTime? UpdatedAt
        +Register()
        +UpdateProfile()
        +VerifyEmail()
        +ChangeRole()
    }

    class UserRole {
        <<enumeration>>
        Driver
        Passenger
        Both
    }

    class ApplicationUser {
        +string FirstName
        +string LastName
        +string Role
        +bool IsEmailVerified
        +DateTime CreatedAt
    }

    class IUserRepository {
        <<interface>>
        +Task~UserEntity~ GetById(Guid id)
        +Task~UserEntity~ GetByEmail(string email)
        +Task Add(UserEntity user)
        +Task Update(UserEntity user)
        +Task~bool~ ExistsByEmail(string email)
    }

    class RegisterUserCommand {
        +string Email
        +string Password
        +string FirstName
        +string LastName
        +string PhoneNumber
        +string Role
    }

    class RegisterUserCommandHandler {
        -IAuthenticationService authService
        -IJwtTokenGenerator jwtGenerator
        -IUnitOfWork unitOfWork
        -IEventPublisher eventPublisher
        +Handle(RegisterUserCommand)
    }

    class LoginUserQuery {
        +string Email
        +string Password
    }

    class LoginUserQueryHandler {
        -IAuthenticationService authService
        -IJwtTokenGenerator jwtGenerator
        +Handle(LoginUserQuery)
    }

    class IAuthenticationService {
        <<interface>>
        +Task~UserEntity~ ValidateUser(string email, string password)
        +Task~Guid~ CreateUser(string email, string password, ...)
        +Task~IList~ GetUserRoles(Guid userId)
    }

    class IJwtTokenGenerator {
        <<interface>>
        +string GenerateToken(UserEntity user, IList roles)
    }

    UserEntity --> UserRole
    ApplicationUser --|> IdentityUser : extends
    RegisterUserCommandHandler --> RegisterUserCommand
    RegisterUserCommandHandler --> UserEntity
    RegisterUserCommandHandler --> IAuthenticationService
    LoginUserQueryHandler --> LoginUserQuery
    LoginUserQueryHandler --> IAuthenticationService
    LoginUserQueryHandler --> IJwtTokenGenerator
