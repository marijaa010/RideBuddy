graph TB
    subgraph Client["Client Layer"]
        SPA["Single Page Application<br/>Angular 18 + SignalR<br/>Port: 8080"]
    end
    
    subgraph Gateway["API Gateway Layer"]
        APIGW["API Gateway<br/>Ocelot<br/>Port: 5000"]
    end
    
    subgraph Services["Microservices Layer"]
        US["User Service<br/>ASP.NET Identity + JWT<br/>Port: 5001<br/>gRPC: 50051"]
        RS["Ride Service<br/>DDD + Outbox<br/>Port: 5002<br/>gRPC: 50052"]
        BS["Booking Service<br/>Orchestration + Outbox<br/>Port: 5003"]
        NS["Notification Service<br/>SignalR Hub + Consumer<br/>Port: 5004"]
    end
    
    subgraph Messaging["Message Broker"]
        RMQ["RabbitMQ<br/>Topic Exchange<br/>Port: 5672<br/>Management: 15672"]
    end
    
    subgraph Databases["Database Layer"]
        DB1[("UserDB<br/>PostgreSQL 16<br/>Port: 5435")]
        DB2[("RideDB<br/>PostgreSQL 16<br/>Port: 5433")]
        DB3[("BookingDB<br/>PostgreSQL 16<br/>Port: 5434")]
        DB4[("NotificationDB<br/>PostgreSQL 16<br/>Port: 5436")]
    end
    
    SPA ==>|HTTP/REST + JWT| APIGW
    SPA -.->|WebSocket| NS
    
    APIGW ==>|HTTP + JWT| US
    APIGW ==>|HTTP + JWT| RS
    APIGW ==>|HTTP + JWT| BS
    APIGW ==>|HTTP + JWT| NS
    
    US -.->|gRPC :50051| RS
    US -.->|gRPC :50051| BS
    US -.->|gRPC :50051| NS
    RS -.->|gRPC :50052| BS
    
    US -->|Domain Events| RMQ
    RS -->|Domain Events| RMQ
    BS -->|Domain Events| RMQ
    RMQ -->|Event Consumer| NS
    
    US <-->|EF Core + Identity| DB1
    RS <-->|EF Core + Outbox| DB2
    BS <-->|EF Core + Outbox| DB3
    NS <-->|EF Core| DB4
    
    style SPA fill:#81C784,stroke:#388E3C,stroke-width:3px,color:#000
    style APIGW fill:#FFB74D,stroke:#F57C00,stroke-width:3px,color:#000
    style US fill:#64B5F6,stroke:#1976D2,stroke-width:3px,color:#000
    style RS fill:#BA68C8,stroke:#7B1FA2,stroke-width:3px,color:#000
    style BS fill:#F06292,stroke:#C2185B,stroke-width:3px,color:#000
    style NS fill:#FFF176,stroke:#F9A825,stroke-width:3px,color:#000
    style RMQ fill:#FF8A65,stroke:#D84315,stroke-width:3px,color:#000
    style DB1 fill:#336791,stroke:#1A3A52,stroke-width:2px,color:#fff
    style DB2 fill:#336791,stroke:#1A3A52,stroke-width:2px,color:#fff
    style DB3 fill:#336791,stroke:#1A3A52,stroke-width:2px,color:#fff
    style DB4 fill:#336791,stroke:#1A3A52,stroke-width:2px,color:#fff
    
    style Client fill:#E8F5E9,stroke:#66BB6A,stroke-width:2px
    style Gateway fill:#FFF3E0,stroke:#FFA726,stroke-width:2px
    style Services fill:#E3F2FD,stroke:#42A5F5,stroke-width:2px
    style Messaging fill:#FFE0B2,stroke:#FF7043,stroke-width:2px
    style Databases fill:#ECEFF1,stroke:#78909C,stroke-width:2px